MODEL (
  name omop.measurement,
  kind FULL,
  description "The MEASUREMENT table contains records of Measurements, i.e. structured values obtained through systematic examination or testing.",
  columns (
    measurement_id BIGINT,
    person_id BIGINT,
    measurement_concept_id INT,
    measurement_date DATE,
    measurement_datetime TIMESTAMP,
    measurement_time TEXT,
    measurement_type_concept_id INT,
    operator_concept_id INT,
    value_as_number REAL,
    value_as_concept_id INT,
    unit_concept_id INT,
    range_low REAL,
    range_high REAL,
    provider_id BIGINT,
    visit_occurrence_id BIGINT,
    visit_detail_id BIGINT,
    measurement_source_value TEXT,
    measurement_source_concept_id INT,
    unit_source_value TEXT,
    unit_source_concept_id INT,
    value_source_value TEXT,
    measurement_event_id BIGINT,
    meas_event_field_concept_id INT
  ),
  column_descriptions (
    measurement_id = 'A unique identifier for each measurement.',
    person_id = 'A foreign key identifier to the Person who had the measurement taken.',
    measurement_concept_id = 'A foreign key identifier to the Standard Concept for the measurement.',
    measurement_date = 'The date when the measurement was taken.',
    measurement_datetime = 'The date and time when the measurement was taken.',
    measurement_time = 'The time when the measurement was taken.',
    measurement_type_concept_id = 'A foreign key identifier to the Concept defining the type of measurement.',
    operator_concept_id = 'A foreign key identifier to the Concept representing the operator applied to the value.',
    value_as_number = 'The numeric value of the measurement result.',
    value_as_concept_id = 'A foreign key identifier to the Concept representing a categorical result.',
    unit_concept_id = 'A foreign key identifier to the Concept representing the unit of the measurement.',
    range_low = 'The lower limit of the normal range for the measurement.',
    range_high = 'The upper limit of the normal range for the measurement.',
    provider_id = 'A foreign key identifier to the Provider associated with the measurement.',
    visit_occurrence_id = 'A foreign key identifier to the Visit Occurrence during which the measurement occurred.',
    visit_detail_id = 'A foreign key identifier to the Visit Detail during which the measurement occurred.',
    measurement_source_value = 'The source code for the measurement as it appears in the source data.',
    measurement_source_concept_id = 'A foreign key identifier to a Measurement Concept that refers to the code used in the source.',
    unit_source_value = 'The source value for the unit.',
    unit_source_concept_id = 'A foreign key identifier to a Unit Concept that refers to the code used in the source.',
    value_source_value = 'The source value for the measurement result.',
    measurement_event_id = 'The primary key of a linked event record.',
    meas_event_field_concept_id = 'A foreign key identifier to the Concept identifying the table of the linked event.'
  ),
  audits (
    person_completeness_measurement,
    measurement_meas_event_field_concept_id_is_foreign_key,
    measurement_meas_event_field_concept_id_is_standard_valid_concept,
    measurement_measurement_concept_id_is_required,
    measurement_measurement_concept_id_is_foreign_key,
    measurement_measurement_concept_id_fk_domain,
    measurement_measurement_concept_id_is_standard_valid_concept,
    measurement_measurement_concept_id_standard_concept_record_completeness,
    measurement_measurement_date_is_required,
    measurement_measurement_date_after_birth,
    measurement_measurement_datetime_after_birth,
    measurement_measurement_id_is_required,
    measurement_measurement_id_is_primary_key,
    measurement_measurement_source_concept_id_is_foreign_key,
    measurement_measurement_type_concept_id_is_required,
    measurement_measurement_type_concept_id_is_foreign_key,
    measurement_measurement_type_concept_id_fk_domain,
    measurement_measurement_type_concept_id_is_standard_valid_concept,
    measurement_measurement_type_concept_id_standard_concept_record_completeness,
    measurement_operator_concept_id_is_foreign_key,
    measurement_operator_concept_id_fk_domain,
    measurement_operator_concept_id_is_standard_valid_concept,
    measurement_person_id_is_required,
    measurement_person_id_is_foreign_key,
    measurement_provider_id_is_foreign_key,
    measurement_unit_concept_id_is_foreign_key,
    measurement_unit_concept_id_fk_domain,
    measurement_unit_concept_id_is_standard_valid_concept,
    measurement_unit_concept_id_standard_concept_record_completeness,
    measurement_unit_source_concept_id_is_foreign_key,
    measurement_value_as_concept_id_is_foreign_key,
    measurement_visit_detail_id_is_foreign_key,
    measurement_visit_occurrence_id_is_foreign_key,
    measurement_3006315_unit,
    measurement_3004410_unit,
    measurement_40487382_unit,
    measurement_3013721_unit,
    measurement_3019198_unit,
    measurement_3034426_unit,
    measurement_3043688_unit,
    measurement_3046485_unit,
    measurement_4216098_unit,
    measurement_4245152_unit,
    measurement_3006923_unit,
    measurement_3021044_unit,
    measurement_3024171_unit,
    measurement_3027114_unit,
    measurement_40762499_unit,
    measurement_3000963_unit,
    measurement_3001604_unit,
    measurement_3019069_unit,
    measurement_3022509_unit,
    measurement_3028288_unit,
    measurement_4148615_unit,
    measurement_44806420_unit,
    measurement_3028437_unit,
    measurement_3016991_unit,
    measurement_3026925_unit,
    measurement_3028615_unit,
    measurement_3051205_unit,
    measurement_4098046_unit,
    measurement_3005131_unit,
    measurement_3011163_unit,
    measurement_3044491_unit,
    measurement_4017361_unit,
    measurement_3006504_unit,
    measurement_3000483_unit,
    measurement_3033543_unit,
    measurement_3045716_unit,
    measurement_4101713_unit,
    measurement_4103762_unit,
    measurement_3001008_unit,
    measurement_3009744_unit,
    measurement_3013115_unit,
    measurement_3019550_unit,
    measurement_3020416_unit,
    measurement_3035583_unit,
    measurement_3035995_unit,
    measurement_3038553_unit,
    measurement_35610320_unit,
    measurement_3001490_unit,
    measurement_4195214_unit,
    measurement_36306178_unit,
    measurement_37393850_unit,
    measurement_3004501_unit,
    measurement_3008598_unit,
    measurement_3018010_unit,
    measurement_3022192_unit,
    measurement_4151768_unit,
    measurement_4197602_unit,
    measurement_46236952_unit,
    measurement_3006906_unit,
    measurement_3007070_unit,
    measurement_3020460_unit,
    measurement_3023314_unit,
    measurement_3035941_unit,
    measurement_3037072_unit,
    measurement_4151358_unit,
    measurement_4194332_unit,
    measurement_3001123_unit,
    measurement_3012888_unit,
    measurement_3013707_unit,
    measurement_3037511_unit,
    measurement_3040168_unit,
    measurement_4097430_unit,
    measurement_3005424_unit,
    measurement_3013603_unit,
    measurement_3020509_unit,
    measurement_3036277_unit,
    measurement_4301868_unit,
    measurement_40762636_unit,
    measurement_40765040_unit,
    measurement_3024386_unit,
    measurement_3009201_unit,
    measurement_3024731_unit,
    measurement_3050479_unit,
    measurement_4012479_unit,
    measurement_4152194_unit,
    measurement_37393840_unit,
    measurement_3000593_unit,
    measurement_3002888_unit,
    measurement_3010910_unit,
    measurement_3013290_unit,
    measurement_3027970_unit,
    measurement_4239408_unit,
    measurement_3010813_unit,
    measurement_3023103_unit,
    measurement_4030871_unit,
    measurement_4154790_unit,
    measurement_4217013_unit,
    measurement_3001318_unit,
    measurement_3004249_unit,
    measurement_3009596_unit,
    measurement_3025315_unit,
    measurement_3053283_unit,
    measurement_4008265_unit,
    measurement_36303797_unit,
    measurement_37398460_unit,
    measurement_3013682_unit,
    measurement_3026361_unit,
    measurement_3027018_unit,
    measurement_4013965_unit,
    measurement_3013429_unit,
    measurement_3023599_unit,
    measurement_3036588_unit,
    measurement_4298431_unit,
    measurement_3017732_unit,
    measurement_3024561_unit,
    measurement_3034639_unit,
    measurement_3013650_unit,
    measurement_3021886_unit,
    measurement_4254663_unit,
    measurement_3001420_unit,
    measurement_3007461_unit,
    measurement_3012030_unit,
    measurement_40764999_unit,
    measurement_3008893_unit,
    measurement_3016723_unit,
    measurement_3026910_unit,
    measurement_3033575_unit,
    measurement_3041084_unit,
    measurement_4184637_unit,
    measurement_4313591_unit,
    measurement_37393851_unit,
    measurement_1619025_unit,
    measurement_3013869_unit,
    measurement_3035472_unit,
    measurement_3039000_unit,
    measurement_3000905_unit,
    measurement_3015632_unit,
    measurement_3032710_unit,
    measurement_4197971_unit,
    measurement_42869452_unit,
    measurement_3002109_unit,
    measurement_3004327_unit,
    measurement_3006322_unit,
    measurement_3008342_unit,
    measurement_3020630_unit,
    measurement_3001122_unit,
    measurement_3009542_unit,
    measurement_3010189_unit,
    measurement_3010457_unit,
    measurement_4192368_unit,
    measurement_3014576_unit,
    measurement_3024128_unit,
    measurement_3018311_unit,
    measurement_3020891_unit,
    measurement_3037556_unit,
    measurement_37399332_unit,
    measurement_3011904_unit,
    measurement_3019897_unit,
    measurement_3025255_unit,
    measurement_4076704_unit,
    measurement_4172647_unit,
    measurement_37393531_unit,
    measurement_40771529_unit,
    measurement_3000034_unit,
    measurement_3035124_unit,
    measurement_3002030_unit,
    measurement_3019170_unit,
    measurement_3020149_unit,
    measurement_3022174_unit,
    measurement_3024929_unit,
    measurement_3049187_unit,
    measurement_37398676_unit,
    measurement_4112223_unit,
    measurement_3017250_unit,
    measurement_4191837_unit,
    measurement_3022096_unit,
    measurement_3034485_unit,
    measurement_44790183_unit,
    measurement_3002400_unit,
    measurement_3003338_unit
  )
);

WITH all_measurements AS (
    SELECT
      *
    FROM int.measurement_observations
    UNION ALL
    SELECT
      *
    FROM int.measurement_procedures
)
SELECT
  ROW_NUMBER() OVER (ORDER BY person_id, measurement_date, measurement_concept_id)::BIGINT AS measurement_id,
  person_id::BIGINT,
  measurement_concept_id::INT,
  measurement_date::DATE,
  measurement_datetime::TIMESTAMP,
  measurement_time::TEXT,
  measurement_type_concept_id::INT,
  operator_concept_id::INT,
  value_as_number::REAL,
  value_as_concept_id::INT,
  unit_concept_id::INT,
  range_low::REAL,
  range_high::REAL,
  provider_id::BIGINT,
  visit_occurrence_id::BIGINT,
  visit_detail_id::BIGINT,
  measurement_source_value::TEXT,
  measurement_source_concept_id::INT,
  unit_source_value::TEXT,
  unit_source_concept_id::INT,
  value_source_value::TEXT,
  measurement_event_id::BIGINT,
  meas_event_field_concept_id::INT
FROM all_measurements