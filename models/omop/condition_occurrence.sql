MODEL (
  name omop.condition_occurrence,
  kind FULL,
  description "Condition Occurrences are records of a Person suggesting the presence of a disease or medical condition stated as a diagnosis, a sign, or a symptom, which is recorded in structured data.",
  columns (
    condition_occurrence_id BIGINT,
    person_id BIGINT,
    condition_concept_id INT,
    condition_start_date DATE,
    condition_start_datetime TIMESTAMP,
    condition_end_date DATE,
    condition_end_datetime TIMESTAMP,
    condition_type_concept_id INT,
    condition_status_concept_id INT,
    stop_reason TEXT,
    provider_id BIGINT,
    visit_occurrence_id BIGINT,
    visit_detail_id BIGINT,
    condition_source_value TEXT,
    condition_source_concept_id INT,
    condition_status_source_value TEXT
  ),
  audits (
    person_completeness_condition_occurrence,
    condition_occurrence_condition_concept_id_is_required,
    condition_occurrence_condition_concept_id_is_foreign_key,
    condition_occurrence_condition_concept_id_fk_domain,
    condition_occurrence_condition_concept_id_is_standard_valid_concept,
    condition_occurrence_condition_concept_id_standard_concept_record_completeness,
    condition_occurrence_condition_end_date_after_birth,
    condition_occurrence_condition_end_datetime_after_birth,
    condition_occurrence_condition_occurrence_id_is_required,
    condition_occurrence_condition_occurrence_id_is_primary_key,
    condition_occurrence_condition_source_concept_id_is_foreign_key,
    condition_occurrence_condition_start_date_is_required,
    condition_occurrence_condition_start_date_start_before_end,
    condition_occurrence_condition_start_date_after_birth,
    condition_occurrence_condition_start_datetime_start_before_end,
    condition_occurrence_condition_start_datetime_after_birth,
    condition_occurrence_condition_status_concept_id_is_foreign_key,
    condition_occurrence_condition_status_concept_id_fk_domain,
    condition_occurrence_condition_status_concept_id_is_standard_valid_concept,
    condition_occurrence_condition_status_concept_id_standard_concept_record_completeness,
    condition_occurrence_condition_type_concept_id_is_required,
    condition_occurrence_condition_type_concept_id_is_foreign_key,
    condition_occurrence_condition_type_concept_id_fk_domain,
    condition_occurrence_condition_type_concept_id_is_standard_valid_concept,
    condition_occurrence_condition_type_concept_id_standard_concept_record_completeness,
    condition_occurrence_person_id_is_required,
    condition_occurrence_person_id_is_foreign_key,
    condition_occurrence_provider_id_is_foreign_key,
    condition_occurrence_visit_detail_id_is_foreign_key,
    condition_occurrence_visit_occurrence_id_is_foreign_key,
    condition_occurrence_26662_gender,
    condition_occurrence_26935_gender,
    condition_occurrence_30969_gender,
    condition_occurrence_73801_gender,
    condition_occurrence_74322_gender,
    condition_occurrence_78193_gender,
    condition_occurrence_79758_gender,
    condition_occurrence_80180_valid_low,
    condition_occurrence_80180_valid_high,
    condition_occurrence_80180_temp,
    condition_occurrence_80809_valid_low,
    condition_occurrence_80809_valid_high,
    condition_occurrence_80809_temp,
    condition_occurrence_81893_valid_low,
    condition_occurrence_81893_valid_high,
    condition_occurrence_81893_temp,
    condition_occurrence_81902_valid_low,
    condition_occurrence_81902_valid_high,
    condition_occurrence_81902_temp,
    condition_occurrence_140168_valid_low,
    condition_occurrence_140168_valid_high,
    condition_occurrence_140168_temp,
    condition_occurrence_141917_gender,
    condition_occurrence_192367_gender,
    condition_occurrence_192671_valid_low,
    condition_occurrence_192671_valid_high,
    condition_occurrence_192671_temp,
    condition_occurrence_192676_gender,
    condition_occurrence_192683_gender,
    condition_occurrence_192854_gender,
    condition_occurrence_192858_gender,
    condition_occurrence_193254_gender,
    condition_occurrence_193261_gender,
    condition_occurrence_193262_gender,
    condition_occurrence_193277_gender,
    condition_occurrence_193437_gender,
    condition_occurrence_193439_gender,
    condition_occurrence_193522_gender,
    condition_occurrence_193530_gender,
    condition_occurrence_193739_gender,
    condition_occurrence_193818_gender,
    condition_occurrence_194092_gender,
    condition_occurrence_194286_gender,
    condition_occurrence_194412_gender,
    condition_occurrence_194420_gender,
    condition_occurrence_194611_gender,
    condition_occurrence_194696_gender,
    condition_occurrence_194871_gender,
    condition_occurrence_194997_gender,
    condition_occurrence_195009_gender,
    condition_occurrence_195012_gender,
    condition_occurrence_195197_gender,
    condition_occurrence_195316_gender,
    condition_occurrence_195321_gender,
    condition_occurrence_195483_gender,
    condition_occurrence_195500_gender,
    condition_occurrence_195501_gender,
    condition_occurrence_195683_gender,
    condition_occurrence_195769_gender,
    condition_occurrence_195770_gender,
    condition_occurrence_195793_gender,
    condition_occurrence_195867_gender,
    condition_occurrence_195873_gender,
    condition_occurrence_196048_gender,
    condition_occurrence_196051_gender,
    condition_occurrence_196068_gender,
    condition_occurrence_196157_gender,
    condition_occurrence_196158_gender,
    condition_occurrence_196163_gender,
    condition_occurrence_196165_gender,
    condition_occurrence_196168_gender,
    condition_occurrence_196359_gender,
    condition_occurrence_196364_gender,
    condition_occurrence_196473_gender,
    condition_occurrence_196734_gender,
    condition_occurrence_196738_gender,
    condition_occurrence_196758_gender,
    condition_occurrence_197032_gender,
    condition_occurrence_197039_gender,
    condition_occurrence_197044_gender,
    condition_occurrence_197236_gender,
    condition_occurrence_197237_gender,
    condition_occurrence_197494_valid_low,
    condition_occurrence_197494_valid_high,
    condition_occurrence_197494_temp,
    condition_occurrence_197507_gender,
    condition_occurrence_197508_valid_low,
    condition_occurrence_197508_valid_high,
    condition_occurrence_197508_temp,
    condition_occurrence_197601_gender,
    condition_occurrence_197605_gender,
    condition_occurrence_197606_gender,
    condition_occurrence_197607_gender,
    condition_occurrence_197609_gender,
    condition_occurrence_197610_gender,
    condition_occurrence_197938_gender,
    condition_occurrence_198082_gender,
    condition_occurrence_198108_gender,
    condition_occurrence_198194_gender,
    condition_occurrence_198197_gender,
    condition_occurrence_198198_gender,
    condition_occurrence_198202_gender,
    condition_occurrence_198212_gender,
    condition_occurrence_198363_gender,
    condition_occurrence_198471_gender,
    condition_occurrence_198483_gender,
    condition_occurrence_198803_gender,
    condition_occurrence_198806_gender,
    condition_occurrence_199067_gender,
    condition_occurrence_199078_gender,
    condition_occurrence_199752_gender,
    condition_occurrence_199764_gender,
    condition_occurrence_199876_gender,
    condition_occurrence_199877_gender,
    condition_occurrence_199878_gender,
    condition_occurrence_199881_gender,
    condition_occurrence_200051_gender,
    condition_occurrence_200052_gender,
    condition_occurrence_200147_gender,
    condition_occurrence_200445_gender,
    condition_occurrence_200452_gender,
    condition_occurrence_200461_gender,
    condition_occurrence_200670_gender,
    condition_occurrence_200675_gender,
    condition_occurrence_200775_gender,
    condition_occurrence_200779_gender,
    condition_occurrence_200780_gender,
    condition_occurrence_200962_valid_low,
    condition_occurrence_200962_valid_high,
    condition_occurrence_200962_gender,
    condition_occurrence_200962_temp,
    condition_occurrence_200970_gender,
    condition_occurrence_201072_gender,
    condition_occurrence_201078_gender,
    condition_occurrence_201211_gender,
    condition_occurrence_201238_gender,
    condition_occurrence_201244_gender,
    condition_occurrence_201257_gender,
    condition_occurrence_201346_gender,
    condition_occurrence_201355_gender,
    condition_occurrence_201527_gender,
    condition_occurrence_201606_valid_low,
    condition_occurrence_201606_valid_high,
    condition_occurrence_201606_temp,
    condition_occurrence_201617_gender,
    condition_occurrence_201625_gender,
    condition_occurrence_201801_gender,
    condition_occurrence_201817_gender,
    condition_occurrence_201820_valid_low,
    condition_occurrence_201820_valid_high,
    condition_occurrence_201820_temp,
    condition_occurrence_201823_gender,
    condition_occurrence_201907_gender,
    condition_occurrence_201909_gender,
    condition_occurrence_201913_gender,
    condition_occurrence_255573_valid_low,
    condition_occurrence_255573_valid_high,
    condition_occurrence_255573_temp,
    condition_occurrence_255848_valid_low,
    condition_occurrence_255848_valid_high,
    condition_occurrence_255848_temp,
    condition_occurrence_313217_valid_low,
    condition_occurrence_313217_valid_high,
    condition_occurrence_313217_temp,
    condition_occurrence_314409_gender,
    condition_occurrence_315586_gender,
    condition_occurrence_316139_valid_low,
    condition_occurrence_316139_valid_high,
    condition_occurrence_316139_temp,
    condition_occurrence_316866_valid_low,
    condition_occurrence_316866_valid_high,
    condition_occurrence_316866_temp,
    condition_occurrence_317576_valid_low,
    condition_occurrence_317576_valid_high,
    condition_occurrence_317576_temp,
    condition_occurrence_318800_valid_low,
    condition_occurrence_318800_valid_high,
    condition_occurrence_318800_temp,
    condition_occurrence_321052_valid_low,
    condition_occurrence_321052_valid_high,
    condition_occurrence_321052_temp,
    condition_occurrence_321588_valid_low,
    condition_occurrence_321588_valid_high,
    condition_occurrence_321588_temp,
    condition_occurrence_381591_valid_low,
    condition_occurrence_381591_valid_high,
    condition_occurrence_381591_temp,
    condition_occurrence_432571_valid_low,
    condition_occurrence_432571_valid_high,
    condition_occurrence_432571_temp,
    condition_occurrence_432867_valid_low,
    condition_occurrence_432867_valid_high,
    condition_occurrence_432867_temp,
    condition_occurrence_433716_gender,
    condition_occurrence_433736_valid_low,
    condition_occurrence_433736_valid_high,
    condition_occurrence_433736_temp,
    condition_occurrence_434251_gender,
    condition_occurrence_435315_gender,
    condition_occurrence_435648_gender,
    condition_occurrence_435783_valid_low,
    condition_occurrence_435783_valid_high,
    condition_occurrence_435783_temp,
    condition_occurrence_436155_gender,
    condition_occurrence_436358_gender,
    condition_occurrence_436366_gender,
    condition_occurrence_436466_gender,
    condition_occurrence_437501_gender,
    condition_occurrence_437655_gender,
    condition_occurrence_438409_valid_low,
    condition_occurrence_438409_valid_high,
    condition_occurrence_438409_temp,
    condition_occurrence_438477_gender,
    condition_occurrence_439727_valid_low,
    condition_occurrence_439727_valid_high,
    condition_occurrence_439727_temp,
    condition_occurrence_439871_gender,
    condition_occurrence_440383_valid_low,
    condition_occurrence_440383_valid_high,
    condition_occurrence_440383_temp,
    condition_occurrence_440417_valid_low,
    condition_occurrence_440417_valid_high,
    condition_occurrence_440417_temp,
    condition_occurrence_440971_gender,
    condition_occurrence_441068_gender,
    condition_occurrence_441077_gender,
    condition_occurrence_441805_gender,
    condition_occurrence_442781_gender,
    condition_occurrence_443211_gender,
    condition_occurrence_443388_valid_low,
    condition_occurrence_443388_valid_high,
    condition_occurrence_443388_temp,
    condition_occurrence_443392_valid_low,
    condition_occurrence_443392_valid_high,
    condition_occurrence_443392_temp,
    condition_occurrence_443435_gender,
    condition_occurrence_443800_gender,
    condition_occurrence_444078_gender,
    condition_occurrence_444106_gender,
    condition_occurrence_444247_valid_low,
    condition_occurrence_444247_valid_high,
    condition_occurrence_444247_temp,
    condition_occurrence_4005743_gender,
    condition_occurrence_4005933_gender,
    condition_occurrence_4006969_valid_low,
    condition_occurrence_4006969_valid_high,
    condition_occurrence_4006969_temp,
    condition_occurrence_4012343_gender,
    condition_occurrence_4016155_gender,
    condition_occurrence_4030518_valid_low,
    condition_occurrence_4030518_valid_high,
    condition_occurrence_4030518_temp,
    condition_occurrence_4032594_gender,
    condition_occurrence_4044013_valid_low,
    condition_occurrence_4044013_valid_high,
    condition_occurrence_4044013_temp,
    condition_occurrence_4048225_gender,
    condition_occurrence_4050091_gender,
    condition_occurrence_4051956_gender,
    condition_occurrence_4054550_gender,
    condition_occurrence_4056903_gender,
    condition_occurrence_4060207_gender,
    condition_occurrence_4060556_gender,
    condition_occurrence_4060558_gender,
    condition_occurrence_4060559_gender,
    condition_occurrence_4061050_gender,
    condition_occurrence_4071874_gender,
    condition_occurrence_4081648_gender,
    condition_occurrence_4090039_gender,
    condition_occurrence_4092515_gender,
    condition_occurrence_4093346_gender,
    condition_occurrence_4095940_gender,
    condition_occurrence_4104000_valid_low,
    condition_occurrence_4104000_valid_high,
    condition_occurrence_4104000_temp,
    condition_occurrence_4109081_gender,
    condition_occurrence_4112853_valid_low,
    condition_occurrence_4112853_valid_high,
    condition_occurrence_4112853_temp,
    condition_occurrence_4128329_gender,
    condition_occurrence_4129155_gender,
    condition_occurrence_4134440_valid_low,
    condition_occurrence_4134440_valid_high,
    condition_occurrence_4134440_temp,
    condition_occurrence_4140828_gender,
    condition_occurrence_4143116_gender,
    condition_occurrence_4147021_gender,
    condition_occurrence_4149084_gender,
    condition_occurrence_4150042_gender,
    condition_occurrence_4150816_gender,
    condition_occurrence_4155529_gender,
    condition_occurrence_4156113_gender,
    condition_occurrence_4162860_gender,
    condition_occurrence_4163261_gender,
    condition_occurrence_4171394_gender,
    condition_occurrence_4171915_gender,
    condition_occurrence_4180790_valid_low,
    condition_occurrence_4180790_valid_high,
    condition_occurrence_4180790_temp,
    condition_occurrence_4180978_gender,
    condition_occurrence_4182210_valid_low,
    condition_occurrence_4182210_valid_high,
    condition_occurrence_4182210_temp,
    condition_occurrence_4185932_valid_low,
    condition_occurrence_4185932_valid_high,
    condition_occurrence_4185932_temp,
    condition_occurrence_4194652_gender,
    condition_occurrence_4199600_gender,
    condition_occurrence_4212540_valid_low,
    condition_occurrence_4212540_valid_high,
    condition_occurrence_4212540_temp,
    condition_occurrence_4235215_gender,
    condition_occurrence_4260520_gender,
    condition_occurrence_4270932_gender,
    condition_occurrence_4279309_valid_low,
    condition_occurrence_4279309_valid_high,
    condition_occurrence_4279309_temp,
    condition_occurrence_4279913_gender,
    condition_occurrence_4281030_gender,
    condition_occurrence_4294393_gender,
    condition_occurrence_4295261_gender,
    condition_occurrence_4303258_gender,
    condition_occurrence_4320332_gender,
    condition_occurrence_4339088_gender,
    condition_occurrence_40481080_gender,
    condition_occurrence_40481902_valid_low,
    condition_occurrence_40481902_valid_high,
    condition_occurrence_40481902_temp,
    condition_occurrence_40482030_gender,
    condition_occurrence_40482406_gender,
    condition_occurrence_40483613_gender,
    condition_occurrence_40490888_gender,
    condition_occurrence_42709954_gender,
    condition_occurrence_45757415_gender,
    condition_occurrence_45766654_gender,
    condition_occurrence_45770892_gender,
    condition_occurrence_45772671_gender,
    condition_occurrence_4090861_gender_desc,
    condition_occurrence_4025213_gender_desc,
    condition_occurrence_4095793_gender_desc,
    condition_occurrence_443343_gender_desc,
    condition_occurrence_4024004_gender_desc,
    condition_occurrence_4172857_gender_desc,
    condition_occurrence_444094_gender_desc,
    condition_occurrence_197810_gender_desc,
    condition_occurrence_4158481_gender_desc
  ),
  column_descriptions (
    condition_occurrence_id = 'A unique identifier for each condition occurrence.',
    person_id = 'A foreign key identifier to the Person who is experiencing the condition.',
    condition_concept_id = 'A foreign key identifier to the Standard Condition Concept for the condition.',
    condition_start_date = 'The date when the condition is first recorded.',
    condition_start_datetime = 'The date and time when the condition is first recorded.',
    condition_end_date = 'The date when the condition resolved or is assumed to have ended.',
    condition_end_datetime = 'The date and time when the condition resolved or is assumed to have ended.',
    condition_type_concept_id = 'A foreign key identifier to the Concept defining the type of condition occurrence.',
    condition_status_concept_id = 'A foreign key identifier to the Concept defining the status of the condition.',
    stop_reason = 'The reason the condition was indicated as ended.',
    provider_id = 'A foreign key identifier to the Provider involved in the diagnosis.',
    visit_occurrence_id = 'A foreign key identifier to the Visit Occurrence during which the condition was recorded.',
    visit_detail_id = 'A foreign key identifier to the Visit Detail during which the condition was recorded.',
    condition_source_value = 'The source code for the condition as it appears in the source data.',
    condition_source_concept_id = 'A foreign key identifier to a Condition Concept that refers to the code used in the source.',
    condition_status_source_value = 'The source code for the condition status as it appears in the source data.'
  )
);

SELECT
  ROW_NUMBER() OVER (ORDER BY p.person_id)::BIGINT AS condition_occurrence_id,
  p.person_id::BIGINT,
  srctostdvm.target_concept_id::INT AS condition_concept_id,
  c.condition_start_date::DATE,
  NULL::TIMESTAMP AS condition_start_datetime, /* DBT model casts NULL */
  c.condition_stop_date::DATE AS condition_end_date,
  NULL::TIMESTAMP AS condition_end_datetime, /* DBT model casts NULL */
  32827::INT AS condition_type_concept_id, /* Hardcoded in DBT model */
  0::INT AS condition_status_concept_id, /* Hardcoded in DBT model */
  NULL::TEXT AS stop_reason, /* DBT model casts NULL to varchar */
  vd.provider_id::BIGINT,
  vd.visit_occurrence_id::BIGINT,
  vd.visit_detail_id::BIGINT,
  c.condition_code::TEXT AS condition_source_value,
  srctosrcvm.source_concept_id::INT AS condition_source_concept_id,
  NULL::TEXT AS condition_status_source_value /* DBT model casts NULL to varchar */
FROM stg.synthea__conditions AS c
INNER JOIN int.source_to_standard_vocab_map AS srctostdvm
  ON c.condition_code = srctostdvm.source_code
  AND srctostdvm.target_domain_id = 'Condition'
  AND srctostdvm.target_vocabulary_id = 'SNOMED'
  AND srctostdvm.source_vocabulary_id = 'SNOMED'
  AND srctostdvm.target_standard_concept = 'S'
  AND srctostdvm.target_invalid_reason IS NULL
INNER JOIN int.source_to_source_vocab_map AS srctosrcvm
  ON c.condition_code = srctosrcvm.source_code AND srctosrcvm.source_vocabulary_id = 'SNOMED' AND srctosrcvm.source_domain_id = 'Condition'
LEFT JOIN int.visit_detail AS vd
  ON c.encounter_id = vd.encounter_id
INNER JOIN int.person AS p
  ON c.patient_id = p.person_source_value